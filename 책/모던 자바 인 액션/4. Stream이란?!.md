# [4장] Stream이란?!

## Stream이란 무엇인가?

: Stream은 Java 8 API에 새로 추가된 기능이다. 

**특징**

1. **선언형**
    
    : 데이터 베이스의 선언형과 같이 표현할 수 있다. 
    
    : 어떻게 필터링을 할것인지 일일히 구현할 필요가 없다.
    
    : 우리가 기대하는 것이 무엇인지 직접 표현(동작의 수행 지정)할 수 있으며, 동적파라미터화(함수형 인터페이스)를 활용하면 변하는 요구사항에 쉽게 대응할 수 있다. 
    
2. **조합가능**
    
    : 여러 빌딩 블록 연산을 연결해 복잡한 데이터 처리 파이프라인을 만들 수 있다. → 유연성이 좋아진다.
    
    : Builder 형식과 유사
    
3. **병렬화**
    
    : 멀티 스레드 코드를 구현하지 않아도 *데이터를 투명하게 병렬*로 처리할 수 있다. 
    
    : stream()을 parallelStream()으로 바꾸면 멀티코어 아키텍처에서 병렬로 실행할 수 있다.
    
    → 이때 정확히 어떤일이 일어나며, 얼만나 많은 스레드가 사용될까? 성능이 좋을까?
    
    → 결과적으로 우리는 데이터 처리과정을 병렬화하면서 스레드와 락 걱정을 할 필요가 없다.
    

<aside>
❓ 스트림 API는 매우 비싼 연산이다?

</aside>

## Stream의 정의와 동작

스트림이란 **데이터 처리 연산**을 지원하도록 **소스**에서 추출된 **연속된 요소**이다.


```java
List<String> dishNames = menu.stream()
														.filter(dish -> dish.getCalories() > 300)
														.map(Dish::getName)
														.limit(3)
														.collection(toList());
```

**데이터 소스**의 **연속된 요소**를 스트림으로 제공한다. 

다음으로 스트림의 filter, map, limit등의 **일련의 데이터 처리 연산**을 적용하면 모든 연산은 서로 **파이프라인**을 형성할 수 있도록 스트림을 반환한다. 

마지막으로 collection이 호출되기 전까지 무엇도 선택되지않으며 출력 결과도 없다. 즉, collection이 호출되기 전까지 저장되는 효과가 있다.

- 파이프라이닝
    
    : 스트림 연산끼리 연결해서 커다란 파이프라인을 구성할 수 있도록 스트림 자신을 반환한다.(중간연산)
    
- 내부 반복

## Stream vs Collection

**연속된 요소**

: 컬렉션과 스트림은 특정 요소 형식으로 이루어진 연속된 값 집합의 인터페이스이다.

`컬렉션` 

→ 현재 자료구조가 포함하는 모든 값을 메모리에 저장하는 자료구조.

→ 모든 요소는 컬렉션에 추가하기전에 계산이 되어야한다.

`스트림` 

→ 이론적으로 요청할 때만 요소를 계산하는 고정된 자료구조이다.

→ 스트림에 요소를 추가하거나 제거할 수 없다.

→ 사용자가 요청한 값만 추출하는 것이 핵심이며 결과적으로 생성자와 소비자 관계를 형성한다.

→ 게으르게 만들어진 컬렉션과 같다.

컬렉션이 DVD 영화라면 스트림은 마치 인터넷 스트리밍 서비스와 같다.


**딱 한번만 탐색**

반복자와 마친가지로 스트림도 한 번만 탐색할 수 있다. 

탐색된 스트림의 요소는 소비되며 소스를 재사용하려고 하면, illegalStateException이 발생한다.



**내부 반복 vs 외부 반복**

사용자가 직접 요소를 반복해야하는 외부반복과 달리 스트림 라이브러리는 내부 반복을 사용한다.


- 내부 반복의 장점
    
    : 병렬 처리가 가능하다.
    
    : 최적화된 순서로 처리할 수 있다. 
    
    → 데이터 표현과 하드웨어를 활용한 병렬성 구현을 자동으로 선택한다.
    
    → 결과적으로 스트림 API는 파이프라인을 더 최적화할 수 있는 유연성을 제공한다.
    

→ 가비지 변수가 생기지 않는다.



## Stream 연산

Stream 인터페이스는 많은 연산의 정의한다. 스트림 인터페이스의 연산은 크게 2가지로 구분할 수 있다.

- **중간 연산**
    
    : 여러 중간 연산을 조립하여 질의를 만들 수 있다.
    
    : 다른 스트림을 반환한다.
    
    : 단말 연산을 수행하기 전까지는 아무 연산도 수행하지 않는다. (Lazy)
    
    : `쇼트서킷`, `루프 퓨전`
    
- **최종 연산**
    
    : 스트림 파이프라인의 결과를 도출한다. 
    
    : Stream 이외의 결과값을 반환한다. (Integer, Collection, Void,..)
