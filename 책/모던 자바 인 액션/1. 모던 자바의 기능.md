# [1장] 모던 자바의 기능

모던자바에서 핵심적으로 바뀐 자바 기능들을 살펴본다. → 람다 표현식, 메소드 참조, 스트림, 디폴트 메서드

### Java 8, 9, 10, 11

자바 역사를 통틀어 Java 8에서 가장 큰 변화가 일어났다.

- Java 8을 이용하면 자연어에 더 가깝게 간단한 방식으로 코드를 구현할 수 있다. (람다)
- 기존의 자바 프로그램은 단일 코어만 사용하였다. 멀티코어 CPU가 대중화되며 Java 8에서는 병렬 실행을 손쉽게 적용할 수 있는 방법을 제공한다. (스트림, Java 9에서는 리액티브 프로그래밍이라는 병렬 실행 기법을 지원한다.)

## 자바의 변화

프로그래밍 언어 생태계에 변화의 바람이 불었다. 하드웨어의 발전과 빅데이터를 다루는 효과적으로 처리하기 위한 과제를 직면하며 병렬 프로세싱을 활용해야 하는데 지금까지의 자바로는 충분이 대응할 수 없었다.

Java 8은 **세가지의 프로그래밍 개념**과 함께 병렬성을 활용하는 코드, 간결한 코드를 구현할 수 있도록 기능을 제공한다.

### 1. 스트림 처리

스트림이란 한번에 한 개씩 만들어지는 연속적인 데이터의 항목들의 모임이다.

이론적으로 프로그램은 입력 스트림에서 데이터를 하나씩 읽어 들이며 출력 스트림으로 데이터를 한 개씩 기록한다. → 스트림은 여러개의 명령을 연결할 수 있으며 병렬로 실행한다. 즉, 조립 라인은 물리적인 순서로 한 개씩 운반하지만 각각의 작업장에서는 동시에 작업을 처리한다.

(유닉스의 명령어 처럼 복잡한 파이프 라인을 구성할 수 있다.)

Java8에서 추가된 **스트림 API**은 개발자가 하려는 작업을 고수준으로 추상화하며, 파이프 라인을 이용하여 CPU 코어에 쉽게 할당할 수 있다는 장점이 있다.

### 2. 동적 파라미터화로 메소드에 코드 전달

Java 8 이전에는 메소드를 다른 메소드로 전달하는 방법이 없었다. 메소드를 다른 메소드의 인수로 넘겨누는 기능을 이론적으로 동적 파라미터라고 한다.

### 3. 병렬성과 가변처리

병렬성은 공짜로 얻을 수 없다. 그렇다면 병렬성의 비용은 뭘까? → 병렬로 처리되는 메소드(스트림 메소드로 전달될 코드)는 동시에 실행 되더라도 안전하게 실행되어야한다.

안전하게 실행하게 실행되는 코드를 만들려면 공유된 **가변 데이터**에 전근하지 않아야한다.

기존처럼 synchronized를 사용하여 가변 데이터를 보호하는 규칙을 만들 수 있지만 시스템 성능에 악영향을 미친다. 특히 다중 프로세싱 코어에서 사용하면 다중 코어가 순차적으로 실행되어야 하므로 병렬의 목적을 무력화하며 훨씬 비싼 비용을 치러야한다.

## 자바의 함수

프로그래밍 언어의 핵심은 값을 바꾸는 것이다. 전통적으로 프로그래밍 언어에서는 이 값을 **일급값(일급 시민)**이라고 하며 자바에서 클래스와 메소드 같은 구조체들은 전달할 수 없는 **이급시민**이다.

자바 8 에서 이급 시민을 일급 시민으로 바꾸는 기능을 추가한다.

- **메소드 참조 (::)** → 이미 정의되어있는 메소드를 간단하게 호출
- **람다(익명 함수)** → 이용할 수 있는 클래스나 메서드가 없을 때 새로운 람다 문법을 이용하여 간결하게 표현

## 스트림

거의 모든 자바 애플리케이션은 컬렉션을 만들고 활용한다. 컬렉션에서는 반복 과정을 직접 처리해야하지만(외부 반복), 스트림 API를 활용하면 루프를 신경 쓸 필요가 없다(내부 반복).

스트림 API는 컬렉션 API와 비슷한 방식으로 동작하지만 컬렉션은 어떻게 데이터를 저장하고 접근할지에 중신을 두는 반면 스트림은 데이터에 어떤 계산을 할 것인지를 묘사하는데 중점을 둔다.

또한 단일CPU로 처리하기 힘든 거대한 리스트의 경우 병렬작업을 손쉽게 사용할 수 없다.

이전 자바 버전에서 제공하는 스레드 API로 멀티스레딩 코드를 구현해서 병렬성을 이용하는 것은 쉽지않다. 데이터를 잘 관리하지 못할경우 원치 않는 방식으로 데이터가 바뀔 수 있다.

## 인터페이스의 디폴트 메소드

자바의 변화 과정에서 자바 개발자들이 겪는 어려움 중 하나는 **기존 인터페이스**의 변경이다. 인터페이스를 업데이트 하려면 해당 인터페이스를 구현하는 모든 클래스도 업데이트 해야하므로 불가능에 가까웠다.

Java8에서 디폴트 메소드로 이문제를 해결할 수 있다.

프로그래머가 직접 디폴트 메서드를 구현하는 상황은 흔치않다. 디폴트 메서드는 특정 프로그램을 구현하는 데 도움을 주는 기능이 아니라 미래에 프로그램이 쉽게 변화할 수 있는 환경을 제공하는 기능이다.

기존의 코드를 건들이지 않고도 원래의 인터페이스 설계를 자유롭게 확장하기 위한 용도이다.

## 함수형 프로그래밍에서 가져온 다른 유용한 아이디어

- Optional<T>
- 패턴 매칭 → 확장된 switch
